<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="\[ \] Protocol Fees # While working on the Uniswap implementation, you&rsquo;ve probably asked yourself, &ldquo;How does Uniswap make money?&rdquo; Well, it doesn&rsquo;t (at least as of September 2022).
In the implementation we&rsquo;ve built so far, traders pay liquidity providers for providing liquidity, and Uniswap Labs, as the company that developed the DEX, is not part of this process. Neither traders, nor liquidity providers pay Uniswap Labs for using the Uniswap DEX.">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="Protocol Fees" />
<meta property="og:description" content="\[ \] Protocol Fees # While working on the Uniswap implementation, you&rsquo;ve probably asked yourself, &ldquo;How does Uniswap make money?&rdquo; Well, it doesn&rsquo;t (at least as of September 2022).
In the implementation we&rsquo;ve built so far, traders pay liquidity providers for providing liquidity, and Uniswap Labs, as the company that developed the DEX, is not part of this process. Neither traders, nor liquidity providers pay Uniswap Labs for using the Uniswap DEX." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://uniswapv3book.com/docs/milestone_5/protocol-fees/" /><meta property="article:section" content="docs" />



<title>Protocol Fees | Uniswap V3 Book 中文版</title>
<link rel="manifest" href="https://uniswapv3book.com/manifest.json">
<link rel="icon" href="https://uniswapv3book.com/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="https://uniswapv3book.com/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css" integrity="sha256-gsXb0jRHzuC0wqo&#43;0Izglh&#43;qQOH6Nw7uT4yfAuDUa18=" crossorigin="anonymous">
  <script defer src="https://uniswapv3book.com/flexsearch.min.js"></script>
  <script defer src="https://uniswapv3book.com/en.search.min.7bcb9cc1edbdbe78ffa7aeda28e09d51033768c24a465538e9da7066e43237d4.js" integrity="sha256-e8ucwe29vnj/p67aKOCdUQM3aMJKRlU46dpwZuQyN9Q=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="https://uniswapv3book.com/"><span>Uniswap V3 Book 中文版</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>Milestone 0. 简介</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/introduction/introduction-to-markets/" class="">交易市场简介</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/introduction/constant-function-market-maker/" class="">恒定函数做市商(CFMM)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/introduction/uniswap-v3/" class="">Uniswap V3</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/introduction/dev-environment/" class="">开发环境</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>Milestone 1. 第一笔交易</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_1/introduction/" class="">简介</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_1/calculating-liquidity/" class="">计算流动性</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_1/providing-liquidity/" class="">提供流动性</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_1/first-swap/" class="">第一笔交易</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_1/manager-contract/" class="">管理合约</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_1/deployment/" class="">部署合约</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_1/user-interface/" class="">用户界面</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>Milestone 2. 第二笔交易</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_2/introduction/" class="">简介</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_2/output-amount-calculation/" class="">输出金额计算</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_2/math-in-solidity/" class="">Solidity中的数学运算</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_2/tick-bitmap-index/" class="">Tick Bitmap Index</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_2/generalize-minting/" class="">通用mint</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_2/generalize-swapping/" class="">通用swap</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_2/quoter-contract/" class="">报价合约</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_2/user-interface/" class="">用户界面</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>Milestone 3. 跨tick交易</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_3/introduction/" class="">简介</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_3/different-ranges/" class="">不同价格区间</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_3/cross-tick-swaps/" class="">Cross-Tick Swaps</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_3/slippage-protection/" class="">Slippage Protection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_3/liquidity-calculation/" class="">Liquidity Calculation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_3/more-on-fixed-point-numbers/" class="">A Little Bit More on Fixed-point Numbers</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_3/flash-loans/" class="">Flash Loans</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_3/user-interface/" class="">User Interface</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>Milestone 4. Multi-pool Swaps</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_4/introduction/" class="">Introduction</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_4/factory-contract/" class="">Factory Contract</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_4/path/" class="">Swap Path</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_4/multi-pool-swaps/" class="">Multi-pool Swaps</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_4/user-interface/" class="">User Interface</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_4/tick-rounding/" class="">Tick Rounding</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>Milestone 5. Fees and Price Oracle</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_5/introduction/" class="">Introduction</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_5/swap-fees/" class="">Swap Fees</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_5/flash-loan-fees/" class="">Flash Loan Fees</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_5/protocol-fees/" class="active">Protocol Fees</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_5/price-oracle/" class="">Price Oracle</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_5/user-interface/" class="">User Interface</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>Milestone 6: NFT positions</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_6/introduction/" class="">Introduction</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_6/erc721-overview/" class="">ERC721 Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_6/nft-manager/" class="">NFT Manager</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/milestone_6/nft-renderer/" class="">NFT Renderer</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>补充资料</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://uniswapv3book.com/docs/reference/dictionary/" class="">中英名词对照</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="https://uniswapv3book.com/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Protocol Fees</strong>

  <label for="toc-control">
    
    <img src="https://uniswapv3book.com/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#protocol-fees">Protocol Fees</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown">
<link rel="stylesheet" href="https://uniswapv3book.com/katex/katex.min.css" />
<script>
  function renderKatex(element) {
    renderMathInElement(document.body, {
      delimiters: [
        { left: '$$', right: '$$', display: true },
        { left: '$', right: '$', display: false },
        { left: '\\(', right: '\\)', display: false },
        { left: '\\[', right: '\\]', display: true }
      ],
      
      throwOnError: false
    });
  }
</script>
<script defer src="https://uniswapv3book.com/katex/katex.min.js"></script>
<script defer src="https://uniswapv3book.com/katex/auto-render.min.js" onload="renderKatex(document.body)"></script><span>
  \[ \]
</span>
<h1 id="protocol-fees">
  Protocol Fees
  <a class="anchor" href="#protocol-fees">#</a>
</h1>
<p>While working on the Uniswap implementation, you&rsquo;ve probably asked yourself, &ldquo;How does Uniswap make money?&rdquo; Well, it
doesn&rsquo;t (at least as of September 2022).</p>
<p>In the implementation we&rsquo;ve built so far, traders pay liquidity providers for providing liquidity, and Uniswap Labs, as
the company that developed the DEX, is not part of this process. Neither traders, nor liquidity providers pay Uniswap
Labs for using the Uniswap DEX. How come?</p>
<p>In fact, there&rsquo;s a way for Uniswap Labs to start making money on the DEX. However, the mechanism hasn&rsquo;t been enabled yet
(again, as of September 2022). Each Uniswap pool has <em>protocol fees</em> collection mechanism. Protocol fees are collected
from swap fees: a small portion of swap fees is subtracted and saved as protocol fees to later be collected by Factory
contract owner (Uniswap Labs). The size of protocol fees is expected to be determined by UNI token holders, but it must
be between $1/4$ and $1/10$ (inclusive) of swap fees.</p>
<p>For brevity, we&rsquo;re not going to add protocol fees to our implementation, but let&rsquo;s see how they&rsquo;re implemented in Uniswap.</p>
<p>Protocol fee size is stored in <code>slot0</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span><span style="color:#75715e">// UniswapV3Pool.sol
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Slot0</span> {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// the current protocol fee as a percentage of the swap fee taken on withdrawal
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// represented as an integer denominator (1/x)%
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint8</span> feeProtocol;
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And a global accumulator is needed to track accrued fees:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span><span style="color:#75715e">// accumulated protocol fees in token0/token1 units
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">ProtocolFees</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint128</span> token0;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint128</span> token1;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>ProtocolFees <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> protocolFees;
</span></span></code></pre></div><p>Protocol fees are set in the <code>setFeeProtocol</code> function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setFeeProtocol</span>(<span style="color:#66d9ef">uint8</span> feeProtocol0, <span style="color:#66d9ef">uint8</span> feeProtocol1) <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">override</span> lock onlyFactoryOwner {
</span></span><span style="display:flex;"><span>    require(
</span></span><span style="display:flex;"><span>        (feeProtocol0 <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> (feeProtocol0 <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">&amp;&amp;</span> feeProtocol0 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">10</span>)) <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>            (feeProtocol1 <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> (feeProtocol1 <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">&amp;&amp;</span> feeProtocol1 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint8</span> feeProtocolOld <span style="color:#f92672">=</span> slot0.feeProtocol;
</span></span><span style="display:flex;"><span>    slot0.feeProtocol <span style="color:#f92672">=</span> feeProtocol0 <span style="color:#f92672">+</span> (feeProtocol1 <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">4</span>);
</span></span><span style="display:flex;"><span>    emit SetFeeProtocol(feeProtocolOld <span style="color:#f92672">%</span> <span style="color:#ae81ff">16</span>, feeProtocolOld <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">4</span>, feeProtocol0, feeProtocol1);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>As you can see, it&rsquo;s allowed to set protocol fees separate for each of the tokens. The values are two <code>uint8</code> that are
packed to be stored in one <code>uint8</code>: <code>feeProtocol1</code> is shifted to the left by 4 bits (this is identical to multiplying it
by 16) and added to <code>feeProtocol0</code>. To unpack <code>feeProtocol0</code>, a remainder of division <code>slot0.feeProtocol</code> by 16 is taken;
<code>feeProtocol1</code> is simply integer division of <code>slot0.feeProtocol</code>  by 4. Such packing works because neither <code>feeProtocol0</code>,
nor <code>feeProtocol1</code> can be greater than 10.</p>
<p>Before beginning a swap, we need to choose one of the protocol fees depending on swap direction (swap and protocol fees
are collected on input tokens):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">swap</span>(...) {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint8</span> feeProtocol <span style="color:#f92672">=</span> zeroForOne <span style="color:#f92672">?</span> (slot0_.feeProtocol <span style="color:#f92672">%</span> <span style="color:#ae81ff">16</span>) <span style="color:#f92672">:</span> (slot0_.feeProtocol <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">4</span>);
</span></span><span style="display:flex;"><span>    ...
</span></span></code></pre></div><p>To accrue protocol fees, we subtract them from swap fees right after computing swap step amounts:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> (...) {
</span></span><span style="display:flex;"><span>    (..., step.feeAmount) <span style="color:#f92672">=</span> SwapMath.computeSwapStep(...);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (cache.feeProtocol <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint256</span> delta <span style="color:#f92672">=</span> step.feeAmount <span style="color:#f92672">/</span> cache.feeProtocol;
</span></span><span style="display:flex;"><span>        step.feeAmount <span style="color:#f92672">-=</span> delta;
</span></span><span style="display:flex;"><span>        state.protocolFee <span style="color:#f92672">+=</span> <span style="color:#66d9ef">uint128</span>(delta);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>After a swap is done, the global protocol fees accumulator needs to be updated:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (zeroForOne) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (state.protocolFee <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) protocolFees.token0 <span style="color:#f92672">+=</span> state.protocolFee;
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (state.protocolFee <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) protocolFees.token1 <span style="color:#f92672">+=</span> state.protocolFee;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Finally, Factory contract owner can collect accrued protocol fees by calling <code>collectProtocol</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">collectProtocol</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">address</span> recipient,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint128</span> amount0Requested,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint128</span> amount1Requested
</span></span><span style="display:flex;"><span>) <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">override</span> lock onlyFactoryOwner <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint128</span> amount0, <span style="color:#66d9ef">uint128</span> amount1) {
</span></span><span style="display:flex;"><span>    amount0 <span style="color:#f92672">=</span> amount0Requested <span style="color:#f92672">&gt;</span> protocolFees.token0 <span style="color:#f92672">?</span> protocolFees.token0 <span style="color:#f92672">:</span> amount0Requested;
</span></span><span style="display:flex;"><span>    amount1 <span style="color:#f92672">=</span> amount1Requested <span style="color:#f92672">&gt;</span> protocolFees.token1 <span style="color:#f92672">?</span> protocolFees.token1 <span style="color:#f92672">:</span> amount1Requested;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (amount0 <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (amount0 <span style="color:#f92672">==</span> protocolFees.token0) amount0<span style="color:#f92672">--</span>;
</span></span><span style="display:flex;"><span>        protocolFees.token0 <span style="color:#f92672">-=</span> amount0;
</span></span><span style="display:flex;"><span>        TransferHelper.safeTransfer(token0, recipient, amount0);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (amount1 <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (amount1 <span style="color:#f92672">==</span> protocolFees.token1) amount1<span style="color:#f92672">--</span>;
</span></span><span style="display:flex;"><span>        protocolFees.token1 <span style="color:#f92672">-=</span> amount1;
</span></span><span style="display:flex;"><span>        TransferHelper.safeTransfer(token1, recipient, amount1);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    emit CollectProtocol(msg.sender, recipient, amount0, amount1);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#protocol-fees">Protocol Fees</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












